# 概述

## 信息安全的目标

1. 可用性
   * 有权使用信息的人任何时候都能使用，无权使用的人任何时候都不能。
2. 保密性
   * 防止信息泄露给未授权实体
3. 完整性
   * 信息未经授权不能改变
4. 不可抵赖性
5. 可控制性
   * 对信息的传播过程及内容具有控制能力的特性

## P2DR安全模型

1. 策略（Policy）
   * 为实现信息系统的安全目标，对所有与信息系统安全相关的活动所制定的策略
2. 防护(Protection) 
   * 信息安全的安全保护措施
3. 检测(detection)
   * 了解和评估信息系统的安全状态，发现信息系统异常行为的机制。
4. 响应(Response)
   * 发现信息系统异常行为后采取的行动

## 信息保障技术框架（IATF）

核心要素：人员、技术、运行

![image-20250107164437893](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107164437893.png)

# 网络攻击

## 分类

1. 主动攻击（可以破坏信息的保密性、完整性和可用性）
   * 篡改信息
   * 欺骗攻击
   * 拒绝服务攻击
   * **重放攻击**

2. 被动攻击（一般只破坏保密性）
   * 嗅探信息
   * 非法访问
   * 数据流分析

## 嗅探攻击

### 原理

![image-20250107163113576](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107163113576.png)

### 后果

* 破坏信息的保密性。

* 嗅探攻击是实现数据流分析攻击的前提。

* 实施重放攻击。

### 集线器和嗅探攻击

> 网卡工作模式
>
> 广播模式：响应目的地址为广播地址的数据帧
>
> 直接模式：响应与目的地址与自己的MAC地址相匹配的数据帧
>
> 混杂模式：所有流经网卡的数据帧都会被上传给网络层， 即接收所有的数据帧

![image-20250107163441227](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107163441227.png)

### 交换机和MAC表溢出攻击

#### 建立MAC表

1. 交换机刚启动时，MAC地址表内无表项
2. 交换机学习
3. 地址表的容量有限
4. 若发现一个帧的入端口和地址表中源MAC地址的所在端口不同，交换机将MAC 地址重新学习到新的端口

#### 溢出攻击

> 关键在于利用表的更新机制破坏地址表

![image-20250107164134537](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107164134537.png)

### 防御

1. 防止黑客终端接入集线器
2. 防止黑客终端接入交换机
3. 交换机需要具有防御MAC表溢出攻击的机制
4. 对于无线通信过程，嗅探攻击是无法避免的，这种情况下，需要对传输的信息进行加密

## 截获攻击

### 原理

![image-20250107165018380](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107165018380.png)

### 后果

1. 获得用户的私密信息

2. 篡改信息

3. 实施重放攻击

### MAC地址欺骗

>  若发现一个帧的入端口和地址表中源MAC地址的所在端口不同，交换机将MAC地址重新学习到新的端口

1. 黑客终端接入以太网

2. 将自己的MAC地址修改为终端D的MAC地址MAC_D

3. 发送以MAC_D为源MAC地址、以广播地址为目的的MAC帧

![image-20250107165628155](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107165628155.png)

#### eg

![image-20250107170344314](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107170344314.png)

1. 连接交换机S3的终端的端口3接入以太网
2. 将自己MAC地址修改为MAC A
3. 发生以MAC A 为源地址，目的地址为广播地址的MAC 帧

![image-20250107170915302](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107170915302.png)

#### 防御

1. 阻止黑客终端接入以太网
2. 阻止黑客终端发送的伪造源MAC地址的以太网帧进入以太网
3. MAC地址与端口绑定
4. 限制广播帧

### ARP欺骗攻击

> 每个终端都有ARP缓冲区，一旦完成地址解析过程，ARP缓冲区建立IP地址与MAC地址的绑定项
>
> 以太网终端无法鉴别ARP请求报文中给出的IP地址与MAC地址绑定项的真伪。(不验证应答包)

![image-20250107174017406](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107174017406.png)

1. 黑客终端发送ARP请求报文（IP A MAC C）
2. 其他终端建立IP A 与 MAC C 之间的绑定 
3. 将目的为IP A 的IP 分组封装成以MAC C 为目的帧

* 图中黑客终端仅有IP R应答

#### 防御

1. 设置静态ARP 绑定关系，即静态设置MAC-IP映射关系，避免被ARP欺骗攻击刷新缓存表。
2. 静态配置路由器的ARP条目，确保到达IP地址的路径合法
3. 根据需要禁用ARP协议
4. 防火墙
5. 以太网交换器提供鉴别ARP请求和响应报文的真伪。

### DHCP欺骗攻击

> 网络存在多个DHCP服务器时，终端随机选择一个提供网络信息
>
> 黑客可伪造DHCP服务器

![image-20250107175427903](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107175427903.png)

LAN1内其他终端通过伪造的DHCP服务器获取IP后，其默认网关是黑客终端，故向局域网的所有IP分组先传给黑客终端，黑客终端复制IP分组后，发送给真正的默认网关，使LAN1内终端始终感觉不到信息已被截获。

### 生成树欺骗攻击

> 交换机工作原理要求交换机之间不存在环路。  交换机被分配唯一的标识符，交换机标识符值最小，优先级最高，为根交换机。

![image-20250107180259459](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107180259459.png)

![image-20250107180327603](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250107180327603.png)

#### 防御

对交换机进行相互认证，不允许黑客终端参与网络生成树建立过程

### 路由项欺骗攻击

#### 原理

![image-20250110204251278](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250110204251278.png)

![image-20250110204411534](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250110204411534.png)

![image-20250110204540837](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250110204540837.png)

#### 防御

1. 验证路由消息

   * 验证消息源：鉴别路由消息的发送端

   * 验证消息完整性 

2. 确定路由消息是由经过认证的相邻路由器发送，且路由消息传输过程中没有被篡改后，才处理该路由消息，并根据处理结果更新路由表。

## 拒绝服务攻击

> 用某种方法耗尽网络设备、链路或服务器资源，使其不能正常提供服务的攻击手段

### SYN泛洪

> 耗尽服务器资源，使服务器不能正常提供服务的攻击手段

1. 快速消耗掉web服务器TCP会话表中连接项
2. 伪造的、网络中不存在的IP地址发起TCP连接建立过程是成功实施SYN泛洪的关键

#### 防御

1. 防止源IP伪造
2. 会话表只对处于完成状态的TCP连接分配连接项。
3. 缩短SYN Timeout时间

### smurf攻击

> 耗尽网络带宽，使被攻击终端不能和其他终端正常通信的攻击手段

1. 伪造ICMP echo request包引起目标主机网络阻塞
2. 以攻击目标IP为源IP，目的IP地址为广播地址的ECHO请求报文。实现放大攻击。

#### 防御

1. 阻止伪造的源IP地址的分组继续传输
2. 阻止以直接广播地址为目的地址的IP分组继续传播
3. 主机拒绝响应ICMP ECHO 请求报文

### DDOS

1. 直接DDOS
   * 直接让肉鸡响应ICMP ECHO 报文
2. 间接DDOS
   * 控制肉鸡让正常主机响应ICMP ECHO 报文

#### 防御

1. 减少肉鸡
2. 使主机拒绝响应ICMP ECHO 请求报文
3. 网络具有统计目的IP 地址相同的ICMP ECHO 响应报文

## 欺骗攻击

1. 攻击源欺骗攻击

   * 源IP地址欺骗攻击

   * 口令入侵

2. 钓鱼网站

   * DNS欺骗攻击
   * 社会工程学

## 非法接入和登录

### 非法接入无线局域网

1. 黑客接入无线局域网需要完成

   ![image-20250111112133148](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111112133148.png)

2. 要完成这三个过程，必须解决两个问题

   1. 获得BSS 的 SSID

      * 黑客终端可以通过侦听信标帧或探测响应帧获得AP的SSID
      * ![image-20250111112506403](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111112506403.png)

   2. 完成共享密钥鉴别机制下的身份鉴别

      * 共享密钥鉴别机制

        * 为所有终端分配一个共享密钥GK（AP和某个终端是否具有关联的依据：是否有共享密钥GK）

        * 终端计算一次性密钥K，将K和P异或结果和初始向量IV发AP判断。

          ​	PRF为随机数生成函数

        * ![image-20250111113627026](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111113627026.png)

        * GK和IV作为随机数种子是为了在共享密钥GK不变的情况下，改变一次性密钥K

      * 黑客终端欺骗AP

        * 由于无线电通信开放性，黑客可侦听带P、（Y,IV）
        * ![image-20250111114423303](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111114423303.png)

      

#### 防御

AP不用通过一次性密钥K异或挑战数P生成的Y来证明授权终端是否有GK

### 非法登录

> 非授权用户远程登录网络设备和Web服务器，并对网络设备和Web服务器进行非法配置的攻击行为

1. 暴力破解
2. 社会工程学获取用户名密码
3. 截获用户名密码
4. ……

## 黑客入侵

## 扫描三步曲

1. 获取网络拓扑结构
2. 获取操作系统类型及版本
3. 获取应用程序类型及版本

# 接入控制和访问控制

## 身份鉴别

> 身份鉴别是验证主体身份与其声称身份是否符合的过程。主体可以是用户、进程和主机等。

1. 分类：1. 单向鉴别 2. 双向鉴别 3. 第三方鉴别
   * ![image-20250111120443230](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111120443230.png)

2. 实施：

   * 主体拥有唯一的身份标识信息（前提）
     * 网络中主要用密钥、用户名和口令、证书和私钥作为主体的身份标识信息

   * 主体以安全的方式（防重放、防假冒）向对方证明其拥有这个标识信息

### 单向身份鉴别

#### 基于共享密钥

![image-20250111120828062](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111120828062.png)

#### 基于用户名和口令

![image-20250111120954006](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111120954006.png)

#### 基于证书和私钥

![image-20250111121209567](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111121209567.png)

### 双向身份鉴别

#### 基于共享密钥

![image-20250111121555085](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111121555085.png)

#### 基于用户名和口令

![image-20250111121659557](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111121659557.png)

#### 基于证书和私钥

![image-20250111121742250](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111121742250.png)

### 第三方鉴别

> 引出第三方鉴别的原因
>
>    无需鉴别者拥有用于证明公钥与示证者之间绑定关系的证书（鉴别者和示证者经常变换的情况下，该过程非常复杂）。由权威机构提供与示证者绑定的公钥。且公钥与示证者之间的绑定关系由权威机构予以证明。

![image-20250111122027427](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111122027427.png)

## Internet接入控制

> 终端接入Internet 过程：在建立的终端和Internet中的资源传输路径上，注册用户使用终端接入Internet的过程
>
> 1. 鉴别是否是注册用户
> 2. 允许注册用户终端建立与Internet资源之间的传输路径

![image-20250111135422722](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111135422722.png)

接入控制设备：

1. 具有普通路由器功能
2. 接入控制功能：
   * 鉴别终端的用户身份
   * 为终端动态分配IP
   * 建立终端的路由项（终端的IP地址和接入控制设备之间传输路径的绑定在一起路由项）

### 终端接入Internet的过程

![image-20250111140012256](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111140012256.png)

### PPP接入控制

> PPP既是基于点对点信道的链路层协议，又是接入控制协议
>
> 采用PPP作为接入控制协议的原因：PPP帧是适合点对点语音信道传输的帧格式

#### 用户身份鉴别协议

PAP（口令鉴别协议）和CHAP（挑战握手鉴别协议）

##### PAP

> 安全性最低
>
> 以明文方式向接入控制设备发送用户名和口令。

![image-20250111140948833](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111140948833.png)

##### CHAP

![image-20250111141037404](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111141037404.png)

#### IPCP(IP控制协议)

1. 为终端动态分配IP等网络信息

2. 分配前提：确定终端接入Internet的过程的用户就是注册用户
3. 即NCP

#### PPP接入控制过程

1. 物理链路停止
   * PPP的开始也是结束状态
2. PPP链路建立
   * 用于PPP链路建立的协议LCP（链路控制协议），建立PPP链路时双方传送LCP帧。
3. 用户身份鉴别
   * 鉴别用户是否为注册用户
4. 网络层协议配置
5. 终止PPP链路
   * 终端和接入控制设备释放建立PPP链路时分配的资源，PPP回到物理链路停止状态。

![image-20250111141748281](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111141748281.png)

## EAP(拓展鉴别协议)

> 引入EAP的原因：多种应用环境和多种鉴别协议两两组合带来的复杂性。

![image-20250111143203204](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111143203204.png)

先定义一种和应用环境无关的、用于传输鉴别协议消息的载体协议，所有应用环境和鉴别协议都和这种载体协议绑定。

### EAP操作模型

![image-20250111143755022](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111143755022.png)

1. 鉴别者向用户发送请求报文，用户向鉴别者回送响应报文。

2. 不同的鉴别机制有不同的请求报文和响应报文的内容

3. 不同的鉴别机制有着不同的请求响应过程

4. EAP定义四种报文：请求、响应、成功、失败

### EAP报文格式

> 不同用户可能采用不同鉴别机制，在开始鉴别过程前，确定用户身份，然后选择对应的鉴别机制鉴别身份

![image-20250111144210966](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111144210966.png)

* 编码字段：报文的类型
* 标识符字段：匹配请求和响应报文
  * 相邻两次请求/响应过程必须采用不同的标识符。
* 长度字段：EAP报文总的长度
* 数据字段：第1个字节是类型字段，用于给出数据内容类型，对应不同的认证机制

### EAP over PPP

#### PPP封装EAP报文过程

![image-20250111144713891](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111144713891.png)

#### 鉴别过程

> 记得写鉴别数据库

![image-20250111145139325](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111145139325.png)

1. 根据CHAP交换鉴别信息

2. 鉴别信息交换过程通过EAP请求/响应过程完成

3. EAP报文封装成PPP帧。

## 802.1X

> 基于端口的访问控制
>
> 实现用户身份鉴别，并开通连接有以太网接入权限的用户终端的端口的接入控制协议。
>
> 通过EAP完成对接入用户的身份鉴别过程

### 802.1X操作模型

![image-20250111150527341](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111150527341.png)

1. 一个物理端口被虚化为两个端口受控端口和非受控端口。
2. EAPOL 给出了EAP报文封装成LAN对应的帧格式。
3. 一但以太网交换机的某个端口开启802.1X鉴别功能，就成为了非受控端口，该端口只能输入输出EAP报文和广播帧，只有成功完成对接入端口的用户身份鉴别后，才能正常输入输出帧

### EAPOL报文格式

![image-20250111151246516](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111151246516.png)

### 802.1X鉴别接入用户身份的过程

![image-20250111151358102](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111151358102.png)

与EAP over PPP两点不同：1. 用户向鉴别者发送请求 2. PPP->EAPOL

### 以太网接入控制过程

![image-20250111151705553](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111151705553.png)

## RADIUS(远程鉴别拨入用户服务)

1. 为了在[802.1X操作模型](#802.1X操作模型)中实施统一鉴别，由鉴别服务器统一完成用户身份鉴别功能。

2. RADIUS 实现鉴别者与鉴别服务器之间双向身份鉴别和身份标识信息传输的应用层协议。

### RADIUS和EAP协调完成用户身份鉴别过程

![image-20250111152625473](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111152625473.png)

# 安全协议

## 功能

1. 双向身份鉴别
2. 数据加密
3. 数据完整性检测
4. 防重放攻击机制

## 安全协议体系结构

![image-20250111153412996](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111153412996.png)

## IPSec

> 1. AH 和 ESP 均实现 IP分组源端鉴别和防重放攻击。
>
> 2. AH只实现数据完整性检测
> 3. ESP实现数据加密和完整性检测
> 4. IKE：实现安全关联的动态建立过程。完成安全关联两端之间的双向身份鉴别过程和安全关联相关安全参数的协商过程。

### 安全关联（SA）

1. 以实现源端鉴别、数据加密和完整性检测为目的的关联称为安全关联（SA）。

2. 安全关联是单向的，用于确定发送者至接收者方向传输方向的安全传输过程所使用的加密算法、加密密钥、MAC（消息鉴别码）算法和MAC密钥等。
3. 安全关联由**SPI（安全参数索引）、目的的IP地址和安全协议标识符**唯一标识
   * 具有相同接收者（目的IP相同）的安全关联需要分配不同的SPI
   * 安全协议标识符指定安全协议，目前有AH协议，ESP协议

###  SPD（安全策略数据库）

1. SPD的目的是将数据分类，然后对不同类的数据施加不同的安全策略，这些安全策略可以是丢弃、使用IPSec和不使用IPSec

2. 分类数据的依据是数据的源和目的IP地址、数据所使用的传输层协议、传输层源和目的端口号、传输数据使用的安全协议、数据所要求的服务类型等

### 工作模式

1. 传输模式
   * ![image-20250111174533116](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111174533116.png)
   * 保护的数据为IP分组的净荷，如TCP、UDP报文和其他基于IP的上层协议报文
   * 用于保证数据端到端安全传输，并鉴别数据源端
2. 隧道模式
   * 保护的数据是IP分组，将整个IP分组作为另一个IP分组的净荷的封装方式
   * 隧道可以建立在任意的两个网络节点之间，安全关联的两端是隧道的两端，点到点的保护数据安全
   * ![image-20250111174758574](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111174758574.png)

![image-20250111175014986](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111175014986.png)

###    防重放攻击

黑客可以重复转发截获的AH或ESP报文，或是延迟一段时间后，再转发截获的AH或ESP报文。

![image-20250111175720117](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111175720117.png)

1. 如果报文序号小于N-W+1，或该序号已被正确接收，丢弃该报文。
2. 如果报文序号在窗口范围内，且未接收过该序号对应的报文，接收该报文并将该序号对应标志改为正确接收。
3. 如果报文序号大于N，假定为L（L>N），将窗口改为[L-W+1,L],并将序号L对应的标注改为已正确接收该序号对应的报文。

### AH

#### 报文格式

![image-20250111180543510](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111180543510.png)

1. 下一个首部

   * 传输模式or隧道模式？

2. 鉴别首部长度
   * AH总长，单位（32位字）
   * 实际长=AH总长-2
   * eg: AH的总长为6个32位字，鉴别首部长度字段为4
3. 序号
   * 防重放
4. 鉴别数据
   * MAC,实现源端身份鉴别和数据完整性认证。

#### 实例

![image-20250111181929143](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111181929143.png)

AH源端鉴别和完整性检测过程（左右分别为发送端和接收端）![image-20250111181936399](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111181936399.png)

### ESP

![image-20250111231044703](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111231044703.png)

![image-20250111231312985](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111231312985.png)

1. 填充长度：为了满足加密算法的需要。

### ESP-AH

先加密后认证：![image-20250111231954784](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111231954784.png)

先认证后加密：![image-20250111232049253](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111232049253.png)

### IKE(Internet 密钥交换协议)

> IKE是一个安全协商SA的协议

####  静态安全关联和动态安全关联

1. 静态安全关联建立机制由人工完成发送端和接收端中安全关联数据库（SAD）的配置过程。
2. 动态安全关联建立机制根据安全传输数据的需要，通过协议建立发送端至接收端的安全关联，协商与该安全关联相关的参数

![image-20250111233938217](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111233938217.png)

## TLS

> IPSec通过安全关联实现IP分组安全关联两端之间的安全传输过程，TLS通过建立安全连接实现数据在两个应用进程之间的双向身份鉴别过程。
>
> 引入原因：对于许多客户/服务器应用结构，实现双向身份鉴别与保证相互交换的数据的保密性和完整性是非常重要的

TLS记录协议：封装上层协议消息

TLS握手协议：实现身份鉴别和安全参数协商

### TLS记录协议封装过程

![image-20250111234909984](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250111234909984.png)

#### TLS握手协议

4个阶段

## HTTPS

1. 基于SSL/TLS

2. 在TCP基础上建立TLS安全连接，经过TLS安全连接实现：
   * 对Web服务器的身份鉴别
   * 浏览器和Web服务器之间传输的HTTP消息的保密性、完整性和源端鉴别

![image-20250112000241508](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112000241508.png)

## DNS Sec

> 实现DNS响应消息的源端鉴别和消息完整性检测，保证响应消息真实性和完整性
>
> 域名服务器之间的关系通过域名服务器中类型为NS的资源记录体现

### 安全威胁

1. DNS响应消息的接收端没有源端鉴别机制，黑客终端可以伪造DNS响应消息，导致完全合格的域名和错误的IP地址（可能是黑客终端地址）绑定
2. DNS响应消息没有完整性保护机制，黑客可以篡改DNS响应消息，篡改域名服务器的IP地址或某个完全合格的域名与IP地址之间的绑定关系

DNS Sec采用基于公钥的方法解决两个安全问题

![image-20250112002134234](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112002134234.png)

* 每一个域生成私钥和公钥对
* 每一个域名服务器配置上一级域域名服务器的公钥，通过DNSKEY类型的资源记录指定

![image-20250112002246899](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112002246899.png)

P158

## SET

>  解决持卡人、商家和银行之间基于Internet进行的电子交易过程中（实现安全的电子购物）的安全性而设计的协议。

持卡人封装处理过程:![image-20250112005119761](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112005119761.png)

![image-20250112005253767](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112005253767.png)

### 双重签名

双重签名：将PI（支付信息） 和 OI（订单信息）持卡人必须能同时向商家和支付网关证明这一次电子消息中涉及的两组信息确实由持卡人给出，还需将这两组信息绑定在一起。

商家不能获得PI，只能给他PIMD

支付网关不能获得OI，只能给他OIMD

![image-20250112010506912](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112010506912.png)

## PGP

> 实现邮件发送端身份鉴别，保证邮件传输过程的保密性和完整性的安全协议。

# 以太网安全技术

## 增强以太网交换机安全功能

1. MAC表溢出攻击的解决思路

限制每一个端口允许接收的源MAC地址不同的MAC帧的数量

2. MAC地址欺骗攻击的解决思路

由管理员确定每一个交换机端口连接的终端的MAC地址，每一个交换机端口只允许接收合法源MAC地址的MAC帧。

3. ARP欺骗攻击的解决思路

交换机中建立正确的MAC地址与IP地址之间的绑定关系，检测ARP请求报文或响应报文中指定的MAC地址与IP地址之间绑定关系的正确性

4. DHCP欺骗攻击的解决思路

由管理员确定允许接收DHCP响应消息的交换机端口，丢弃所有从其他端口接收到的DHCP响应消息。

5. 生成树欺骗攻击

由管理员确定参与生成树建立过程的交换机端口，其他交换机端口一律丢弃接收到的BPDU

## 以太网接入控制技术

### 静态配置访问控制列表

![image-20250112104647545](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112104647545.png)

![image-20250112104931942](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112104931942.png)

交换机有关访问控制列表的配置如下：

1. 所有交换机启动接入访问控制功能，配置上图中的访问控制列表

### 安全端口

![image-20250112104819864](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112104819864.png)

以太网接入控制过程解决：1.限制源MAC地址不同的MAC帧数量，防MAC表溢出攻击2. 指定交换机端口终端的MAC地址，防MAC地址欺骗攻击

![image-20250112113217449](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112113217449.png)

交换机安全端口配置：

1. 所有交换机启动接入访问控制功能
2. S1.1、S1.2、S3.1、S3.2启动安全端口功能，并将自动学习到的MAC地址数设置为1
3. S1.3、S2.1、S2.2、S3.3启动安全端口功能，并将自动学习到的MAC地址数设置为2

### 802.1X

![image-20250112105154736](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112105154736.png)

以下情况下，交换机删除访问控制列表中的MAC地址：

* 用户退出网络访问过程
* 在规定时间内没有接收到来自于该MAC的帧

### 防欺骗攻击

![image-20250112111227519](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112111227519.png)

与交换机和DHCP服务器相连的为信任端口

#### 防ARP欺骗攻击

不合法的ARP报文，交换机查看DHCP帧听信息库后将丢弃。 

#### 防源IP地址欺骗

当交换机通过非信任端口接收到某个IP分组，用该IP分组的源IP地址和封装该IP分组的MAC帧的源MAC地址匹配交换机的DHCP侦听信息库

### 生成树欺骗攻击与防御机制

1. 交换机中有两类端口

   * 实现交换机之间互连的端口，称为主干端口

   * 直接连接终端的端口，称为接入端口

2. 将交换机接入端口设置成不运行生成树协议的端口，该端口不会发送、接收BPDU

# 无线局域网安全技术

## WEP

### 缺陷

1. 只能实现AP对终端单向身份鉴别
2. CRC-32作为完整性检验值会导致接收端无法检测出已经发生的篡改。

## 安全缺陷

1. 共享密钥鉴别机制缺陷-异或加密机制漏洞
2. 初始向量太短-加密机制漏洞
3. 完整性认证机制的安全缺陷——CRC线性漏洞
4. 静态共享密钥配置漏洞
   * 同一BSS的所有终端共享相同的密钥且静态配置

## 802.11i

### 802.11i的安全增强

1. 基于EAP的802.1X的用户认证，实现双向鉴别

2. 初始向量增加为48位、加密采用临时密钥完整性协议（TKIP）、CCMP
   * TKIP是尽量和WEP兼容，但又比WEP有着更安全的加密和完整性检测机制的一种加密认证机制。
   * CCMP和WEP没有相关性，采用较复杂的加密和完整性检测算法。

3. 利用报文摘要作为完整性校验值并加密

4. 基于用户动态配置密钥，不同用户使用不同的密钥，同一用户每一次接入无线局域网使用不同的密钥。终端与AP之间的使用临时密钥（TK）

#### TKIP

![image-20250112121127925](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112121127925.png)

* TSC：序号计数器，代替WEP的24位初始向量。每发送一MAC帧，TSC加1，防重放。
* TA：发生端地址，参与加密每一帧的一次性密钥产生过程，使每一个发生端有单独的48位序号空间，即每个终端有2^48^个一次性密钥，保证不重复使用一次性密钥。
* TK：临时密钥，只在安全关联存在期间有效,发送端和接收端成功交换加密数据的前提是拥有相同的临时密钥TK
* MIC：消息完整性编码，同MAC（消息鉴别码），检测数据序列传输过程中的完整性。
* SA：源MAC地址
* 优先级：1B

#### CCMP

> 基于AES的CCM 模式

![image-20250112122358557](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112122358557.png)

* 随机数由报文序号、发送端地址和优先级组成，使得不同发送端、不同MAC帧的随机数均不相同
* 附加认证数据由MAC首部中传输过程中不变的字段组成，需要对这些字段的完整性进行检测

![image-20250112122410246](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112122410246.png)

# 互联网安全技术

## 路由项过滤

R1连接R2的接口配置![image-20250112125811024](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112125811024.png)

## 单播反向路径验证

防源IP地址欺骗攻击

![image-20250112130611016](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112130611016.png)

## 策略路由

1. 策略路由允许为符合特定条件的IP分组选择特殊的传输路径

2. 策略路由项分为两部分：

   * IP分组分类条件：
     * IP首部和TCP首部字段值

   * 下一跳地址

## 流量管制

### 管制算法

1. 漏斗算法
2. 令牌桶算法
   * ![image-20250112131512735](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112131512735.png)

![image-20250112132044708](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112132044708.png)

## NAT

### 类型

1. 静态NAT
2. 动态NAT
3. PAT

## VRRP

# VPN

## 第三层隧道和IPSec

  隧道用于实现企业局域网之间以私有IP地址为源和目的IP地址的IP分组的传输过程。

### 内部网络之间IP分组传输过程

1. 将IP分组封装成GRE（通用路由封装）格式
2. 将GRE格式作为净荷封装成以边界路由器R1连接Internet的接口的全球IP地址为源、以边界路由器R2连接Internet的接口的全球IP地址为目的IP地址的IP分组
3. 由于该IP分组的净荷是另一个IP分组的GRE格式，将这种IP分组称为隧道报文。

![image-20250112144655275](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112144655275.png)

## IPSec 和安全传输过程

1. 建立安全传输通道
2. 建立安全关联

安全关联传输隧道报文过程：<img src="https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112145448009.png"/>

协议类型50表示该IP分组净荷是ESP报文

## 第二层隧道和IPSec

隧道用于实现PPP帧传输过程

### L2TP

 终端发起建立第二层隧道方式

前提是远程终端已经连接到Internet上，且已经分配全球IP地址

## SSL VPN

![image-20250112141234519](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112141234519.png)

# 防火墙

## 分组过滤器

> 从一个网络进入另一个网络的全部IP分组中筛选出符合用户指定特征的一部分IP分组，并对这一部分IP分组的网络间传输过程实施控制。

### 无状态分组过滤器

实施筛选和控制操作时，每一个IP分组都是独立的，不考虑IP分组之间的关联性

####  写过滤规则

![image-20250112151531177](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112151531177.png)

R1接口输入方向上：

* 协议类型=TCP，源IP地址=193.1.1.0/24，目的IP地址=193.1.2.5，目的端口号=23；丢弃
* 协议类型=*，源IP地址=any,目的IP地址=any;正常转发

![image-20250112152219959](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112152219959.png)



R1接口1输入方向：

* 协议类型=TCP，源IP地址=192.1.1.1/32，源端口号=*，目的IP地址=192.1.2.7/32，目的端口号=80；正常转发
* 协议类型=TCP，源IP地址=192.1.1.7/32，源端口号=21，目的IP地址=192.1.2.1/32，目的端口号=*；正常转发
* 协议类型=TCP，源IP地址=192.1.1.7/32，源端口号=20，目的IP地址=192.1.2.1/32，目的端口号=*；正常转发
* 协议类型=*，源IP地址=any,目的IP地址=any；丢弃

R2接口2输入方向：

* 协议类型=TCP，源IP地址=192.1.2.1/32，源端口号=*，目的IP地址=192.1.1.7/32，目的端口号=21；正常转发
* 协议类型=TCP，源IP地址=192.1.2.1/32，源端口号=*，目的IP地址=192.1.1.7/32，目的端口号=20；正常转发
* 协议类型=TCP，源IP地址=192.1.2.7/32，源端口号=80，目的IP地址=192.1.1.1/32,目的端口号=*；正常转发
* 协议类型=*，源IP地址=any,目的IP地址=any；丢弃

### 有状态分组过滤器

> 匹配路由器R1接口1输出方向过滤规则的IP分组未必就是封装Web服务器用于响应终端A访问请求的响应报文的IP分组。原因是，响应报文不是固定的，而是根据请求报文动态变化的。
>
> 为了实现路由器R1接口1只允许输入输出与终端A发起访问web服务器的操作有关的IP分组，禁止输入输出其他一切类型的IP分组的安全策略

#### 写访问控制策略

![image-20250112160551416](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112160551416.png)

![image-20250112160819666](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112160819666.png)

访问策略和分组过滤不同，不是定义了允许或不允许传输的IP分组，而是定义了整个服务过程。如第一项策略表示允许进行由信任区中终端发起的，对非军事区中的WEB服务器的访问。它允许符合这个访问过程的IP分组在信任区和非军事区之间传输。

### 电路层代理

![image-20250112183655038](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112183655038.png)

  假定源主机是终端B，目的主机是Web服务器，源主机与目的主机之间无法直接建立TCP连接。

![image-20250112183927442](https://typora5672.oss-cn-chengdu.aliyuncs.com/temp/image-20250112183927442.png)

# IDS

入侵检测机制：

1. 协议译码
2. 攻击特征匹配
3. 异常检测
